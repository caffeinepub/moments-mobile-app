{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 8,
  "summary": "Moments is being refined into a minimal, planning-first + capture-and-store app (non-social). The Home experience is centered on a single-row weekly calendar and a simple “Start Planning” flow that opens a bottom sheet planner; saved plans appear as pill-shaped planned cards below the calendar. Planned dates are color-coded with a deterministic pastel per date (one plan per day), and the calendar’s selected date pill matches the plan’s border color; deleting a plan removes its date color. Camera capture remains core for saving moments; the Vault is being treated as a private Moments gallery (photos/videos), with improved viewing (enlarged) and motion, and storage constrained by a local media limit. Bottom navigation is being adjusted to remove the Calendar tab and replace it with a Notifications bell icon (icon-only / static).",
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Client-side routing across primary app screens",
      "synonyms": [
        "TanStack Router",
        "SPA navigation"
      ],
      "description": "Defines top-level routes for splash (/), welcome (/welcome), home (/home), camera (/camera), save confirmation (/save-moment), feeling check (/feeling-check), calendar (/calendar), vault (/vault), vault detail (/vault/$momentId), profile (/profile), and settings (/settings).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "Mobile-first fixed viewport page layout",
      "synonyms": [
        "390x844 viewport container",
        "Mobile-centered UI"
      ],
      "description": "Pages render as fixed full-screen overlays with a centered mobile viewport (max 390x844) to maintain consistent composition on desktop and mobile.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "Animated onboarding splash slideshow (3 cards)",
      "synonyms": [
        "Onboarding carousel",
        "3D card transitions"
      ],
      "description": "Implements a 3-slide splash experience with per-slide theming, timed auto-advance, manual Prev/Next controls, and direction-aware 3D transitions.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "Splash cards support mixed media (video + images)",
      "synonyms": [
        "Video slide",
        "Eager-loaded splash assets"
      ],
      "description": "Slide 1 renders an autoplaying looping muted MP4; slides 2–3 render images with eager loading/priority hints and per-card layout adjustments.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "Preloading of splash and welcome media assets",
      "synonyms": [
        "HTML preload hints",
        "Faster onboarding"
      ],
      "description": "index.html preloads the splash video, splash images, and the welcome image to reduce perceived loading during onboarding.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "Internet Identity authentication provider and hook",
      "synonyms": [
        "InternetIdentityProvider",
        "AuthClient integration"
      ],
      "description": "Provides identity state on reload, login/logout actions, delegation validity checks to avoid redundant logins, and explicit status flags (initializing/idle/logging-in/success/loginError).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Auth-aware splash CTA and post-auth navigation",
      "synonyms": [
        "Smart Sign In button",
        "Continue when authenticated"
      ],
      "description": "On slide 3, CTA adapts to auth state (Loading/Connecting/Continue/Sign In). If identity exists, navigates to /welcome; otherwise initiates Internet Identity login. Also auto-navigates when identity becomes available while on slide 3.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "Welcome screen with coordinated entrance animations",
      "synonyms": [
        "Post-login welcome page",
        "Get Started CTA"
      ],
      "description": "Renders an animated welcome card consistent with onboarding motion and provides a Get Started button that navigates to /home.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "React Query global setup",
      "synonyms": [
        "QueryClientProvider",
        "Client caching layer"
      ],
      "description": "Creates a global QueryClient and wraps the app to enable query caching and invalidation patterns.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Backend actor creation and caching keyed by principal",
      "synonyms": [
        "useActor",
        "Authenticated/anonymous actor"
      ],
      "description": "Creates an anonymous backend actor when unauthenticated and an authenticated actor when identity exists; caches via React Query using principal in the query key and invalidates/refetches other queries when the actor changes.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "Secret token extraction from URL hash with session persistence",
      "synonyms": [
        "Admin token in hash",
        "URL secret cleanup"
      ],
      "description": "Utilities read parameters from query string or hash; sensitive secrets are read from the hash fragment, persisted to sessionStorage, and removed from the URL via history.replaceState to reduce leakage.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "RBAC bootstrap on authenticated actor creation",
      "synonyms": [
        "_initializeAccessControlWithSecret",
        "Admin bootstrap secret"
      ],
      "description": "After creating an authenticated backend actor, the frontend calls _initializeAccessControlWithSecret with a secret token (e.g., caffeineAdminToken) to register the caller in the backend access-control system.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "Local planned moments persistence with change events",
      "synonyms": [
        "plannedMomentsStorage",
        "Local planner data"
      ],
      "description": "Stores planned moments in localStorage with generated IDs and createdAt timestamps; emits a custom 'plannedMomentsChanged' event for immediate same-tab updates and also listens to 'storage' for cross-tab changes.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Deterministic planned-moment color palette assignment",
      "synonyms": [
        "getColorForDate",
        "Palette hashing"
      ],
      "description": "Assigns a deterministic OKLCH palette color based on date string hashing (used when saving planned moments so colors persist per moment).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "Up to 3 planned-moment color segments per date",
      "synonyms": [
        "Date segment colors map",
        "Multi-moment per-day visualization"
      ],
      "description": "Derives a date→colors map (up to 3 colors per date) by grouping planned moments per date and selecting colors deterministically by sorted time order.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "Immediate planned-date indicator updates after saving planned moments",
      "synonyms": [
        "Planned-date pill updates",
        "Reactive planned-date marking"
      ],
      "description": "Planned moment saves dispatch a custom event to refresh hooks/components so date indicators update immediately and remain marked as long as at least one planned moment exists for that date.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "Planned moments hook for reactive UI state",
      "synonyms": [
        "usePlannedMoments",
        "Planner state adapter"
      ],
      "description": "Exposes planned moments for an optional selected date plus datesWithMoments, dateSegmentColors, and a sorted list of dates with moments; auto-refreshes via storage/custom event subscriptions.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "Planned moment creation bottom sheet",
      "synonyms": [
        "PlannedMomentBottomSheet",
        "Plan a Moment sheet"
      ],
      "description": "Bottom sheet with open/close animations, compact time/title inputs, Save/Cancel actions, optional rescheduling via native date picker, and automatic per-date palette color assignment on save.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-19",
      "title": "Calendar page weekly view with planned and photo indicators",
      "synonyms": [
        "CalendarPage",
        "Weekly strip"
      ],
      "description": "Renders a week strip with month and week navigation; indicates planned moments using up to 3 segment colors and indicates photo moments with a gray dot; opens the planner bottom sheet on date click and lists planned moments for the selected date.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "Home weekly calendar strip with multi-segment indicators",
      "synonyms": [
        "HomeWeeklyCalendarStrip",
        "Week row selector"
      ],
      "description": "Reusable component rendering Sun–Sat, previous/next week controls, selected-day styling, and up to 3 colored dot indicators for dates with planned moments (using dateSegmentColors).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "Segmented planned date pill UI component",
      "synonyms": [
        "PlannedDatePill",
        "Multi-segment pill"
      ],
      "description": "Clickable pill that formats an ISO date into a short label (e.g., Jan 15) and renders a multi-segment background (up to 3 colors) representing planned moments.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "IF-22",
      "title": "Home planned-dates horizontal row",
      "synonyms": [
        "HomePlannedDatesRow",
        "Swipeable planned-date pills"
      ],
      "description": "Displays a single-line horizontally scrollable row of planned-date pills (touch/trackpad swipe/scroll) reusing the same up-to-3 segment color logic as the calendar.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "IF-23",
      "title": "Optional auto-drift animation for Home planned-dates row",
      "synonyms": [
        "Gentle drift",
        "Auto-scroll with pause-on-interaction"
      ],
      "description": "Applies a subtle auto-drift scrolling effect that pauses while users interact (pointer/touch/wheel/scroll) and resumes after an idle delay.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "IF-24",
      "title": "Home screen planning-first dashboard",
      "synonyms": [
        "HomeScreen",
        "Planning hub"
      ],
      "description": "Home includes a logo header, a search input stub, the planned-dates row, a weekly calendar strip, and a planning prompt with a Start Planning CTA that opens the planner bottom sheet.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-25",
      "title": "Updated Home bottom navigation with Notifications tab (non-navigating)",
      "synonyms": [
        "Footer nav reorder",
        "Bell icon notifications"
      ],
      "description": "Home footer nav is reordered to Home → Vault → Camera → Notifications → Profile; Calendar tab is removed and replaced with a Notifications bell icon that does not navigate to any screen.",
      "reqIds": [
        "REQ-11",
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "IF-26",
      "title": "Camera hook for getUserMedia lifecycle and photo capture",
      "synonyms": [
        "useCamera",
        "MediaStream management"
      ],
      "description": "Encapsulates camera support detection, stream lifecycle cleanup, facing-mode switching, retry handling, and photo capture via canvas→Blob→File with categorized errors.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-27",
      "title": "Camera screen: capture or upload, review, then continue",
      "synonyms": [
        "CameraScreen",
        "Capture flow"
      ],
      "description": "Full-screen camera UI that auto-starts the camera, supports capture, retake, switch camera, retry on errors, and gallery upload. Converts captured/uploaded image to base64 draft and navigates to /save-moment.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-28",
      "title": "Session-based draft storage for multi-step capture flow",
      "synonyms": [
        "pendingMomentDraftStorage",
        "Session draft persistence"
      ],
      "description": "Uses sessionStorage to persist a photo draft, confirmation fields (who/reflection), and the saved moment ID across camera → confirm → feeling screens, and supports clearing all draft state.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-29",
      "title": "Save moment confirmation screen (who + reflection) with local persistence",
      "synonyms": [
        "SaveMomentConfirmPage",
        "Post-capture confirmation"
      ],
      "description": "Shows a captured photo preview, lets the user pick who it was with and add an optional reflection, saves the moment locally, stores its ID for the feeling step, supports retake, and navigates to /feeling-check.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-30",
      "title": "Post-save feeling check-in for a moment",
      "synonyms": [
        "MomentFeelingCheckPage",
        "Emotional check-in"
      ],
      "description": "Prompts for one of three feelings (Meaningful/Good/Okay), updates the stored moment record, clears session draft state, and returns to /home.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-31",
      "title": "Local moments photo storage utilities with update events",
      "synonyms": [
        "momentsPhotosStorage",
        "Local photo moments registry"
      ],
      "description": "Stores photo moments (data URL, timestamp, type, who, reflection, feeling) in localStorage; supports load, update by ID, getMostRecentPhoto, and dispatches a same-tab 'moments_photos_updated' event.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-32",
      "title": "Moments photos hook with reactive refresh",
      "synonyms": [
        "useMomentsPhotos",
        "Storage/event listeners"
      ],
      "description": "Loads photos and tracks the most recent photo; stays in sync via filtered 'storage' events (moments_photos) and the custom 'moments_photos_updated' event.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-33",
      "title": "Vault gallery grouped by month with in-view animations",
      "synonyms": [
        "VaultPage",
        "Memory vault grid"
      ],
      "description": "Groups saved moments by month/year, renders a 3-column thumbnail grid (limited to 6 per month) with IntersectionObserver-based entrance animations, and navigates to a detail viewer on tap. Shows a feeling badge on thumbnails when available.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-34",
      "title": "Vault moment detail viewer with metadata overlay",
      "synonyms": [
        "VaultMomentPage",
        "Full-screen moment view"
      ],
      "description": "Displays a single moment full-screen with a close/back control, contained image scaling, relative time formatting, and a bottom gradient overlay for who/reflection/feeling.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-35",
      "title": "IntersectionObserver-based in-view hook",
      "synonyms": [
        "useInView",
        "Viewport detection"
      ],
      "description": "Hook that detects when an element enters the viewport (threshold/rootMargin), optionally trigger-once, used for Vault month/thumbnail entrance animations.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-36",
      "title": "Relative time formatting utility",
      "synonyms": [
        "formatRelativeTime",
        "Timestamp labels"
      ],
      "description": "Formats timestamps into compact relative labels (seconds/minutes/hours/days) and falls back to a short date for older moments.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-37",
      "title": "Local-first profile storage with invite code generation",
      "synonyms": [
        "profileStorage",
        "Invite code"
      ],
      "description": "Stores a user profile in localStorage, ensures an invite code exists (generating if missing), and dispatches 'profile_updated' for same-tab updates.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-38",
      "title": "Auto-geolocation hook (once per session)",
      "synonyms": [
        "useAutoGeolocation",
        "Session-gated geolocation"
      ],
      "description": "Requests browser geolocation at most once per session (sessionStorage-gated); invokes onSuccess with coordinates if granted and logs denials/errors without throwing.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-39",
      "title": "Profile hook with auto-geolocation and reactive updates",
      "synonyms": [
        "useProfile",
        "Profile state adapter"
      ],
      "description": "Manages profile state, automatically requests geolocation when location/coordinates are missing, persists coordinates and a formatted location string, and listens for 'profile_updated' and 'storage' to refresh state.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-40",
      "title": "Profile management screen (edit fields, upload photo, copy invite code)",
      "synonyms": [
        "ProfilePage"
      ],
      "description": "UI to edit display name/location, upload a profile picture (FileReader→data URL), copy invite code to clipboard with fallback, show inline toast feedback, and navigate to Settings or Home.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-41",
      "title": "Inline toast notification component",
      "synonyms": [
        "InlineToast",
        "In-app confirmations"
      ],
      "description": "Reusable toast component with auto-dismiss and fade/slide-out animation for lightweight confirmations (e.g., profile saved, invite code copied).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-42",
      "title": "Settings screen with logout",
      "synonyms": [
        "SettingsPage",
        "Sign out"
      ],
      "description": "Renders compact grouped settings sections (mostly placeholders) and supports logout by clearing Internet Identity state and routing back to splash (/).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-43",
      "title": "Moment feed card UI component",
      "synonyms": [
        "MomentsImageCard",
        "Glassmorphic moment card"
      ],
      "description": "Presentational card that renders a moment image with profile avatar/name/location, a timestamp label, and quiet metadata display for who/reflection/feeling (no social actions).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-44",
      "title": "Reserved module for future React Query backend hooks",
      "synonyms": [
        "useQueries placeholder"
      ],
      "description": "Placeholder module reserved for future backend query hooks; currently exports nothing.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-45",
      "title": "Backend role-based access control (RBAC) with admin bootstrap secret",
      "synonyms": [
        "AccessControl",
        "MixinAuthorization"
      ],
      "description": "Motoko RBAC supports roles (#admin/#user/#guest), initialization using an environment secret (CAFFEINE_ADMIN_TOKEN) plus user-provided token, admin role assignment, and endpoints to query caller role/admin status.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-46",
      "title": "Backend user profile API with authorization checks",
      "synonyms": [
        "getCallerUserProfile",
        "saveCallerUserProfile",
        "getUserProfile"
      ],
      "description": "Stores user profiles keyed by Principal; authenticated users can read/save their own profile and admins can read other users’ profiles.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-47",
      "title": "Backend user settings API with authorization checks",
      "synonyms": [
        "getCallerSettings",
        "saveCallerSettings"
      ],
      "description": "Stores per-user settings keyed by Principal; requires authenticated user role for read/write.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-48",
      "title": "Backend moments photo metadata registry (per-user index)",
      "synonyms": [
        "storePhoto metadata",
        "getCallerMomentsPhotos",
        "deletePhoto"
      ],
      "description": "Maintains a per-user list of photo metadata records (id/owner/timestamp/blobId) with authenticated store/list and owner-only delete behavior; actual blob persistence is not yet implemented.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-49",
      "title": "Backend blob-storage maintenance and authorization endpoints",
      "synonyms": [
        "MixinStorage",
        "Dead blob pruning",
        "Cycles refill",
        "Gateway principal allowlist"
      ],
      "description": "Provides endpoints to update authorized gateway principals, check blob liveness, list and confirm deletion of dead blobs (authorized callers), trigger GC after pruning, create a certificate stub response, and refill cycles via a cashier principal.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "feature-promote-draft-version-146-to-be-the-active-live-deployment-and-ensure-the-app-no-longer-reverts-back-to-version-125-after-deployment-completes",
      "title": "Promote Draft Version 146 to be the active live deployment and ensure the app no longer reverts back to Version 125 after deployment completes.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-version-125-from-being-the-active-live-deployment-i-e-ensure-version-125-is-no-longer-the-live-version-once-146-is-live",
      "title": "Remove Version 125 from being the active live deployment (i.e., ensure Version 125 is no longer the live version once 146 is live).",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Home planning flow: single-row weekly calendar on Home + “Start Planning” opens slide-up planner; saved planned moments render below calendar as pill cards; start button shrinks to + after first plan",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-2",
      "summary": "Planned moment color system: deterministic muted pastel per date; one planned moment per day; date pill color matches card border; deletion removes date color; show friendly in-frame warning if user tries to plan twice on same date",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-3",
      "summary": "Planner bottom-sheet UI polish: smooth eased translate open/close; hide navbar while open; improve date/time inputs; add date-change arrow; keep UI compact and mobile-friendly",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-4",
      "summary": "Bottom navbar change: remove Calendar icon/tab and replace with Notifications bell icon (icon-only, no feature/UI behind it for now); order Home → Moments/Vault → Camera → Notifications → Profile",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-5",
      "summary": "Local media storage limit: increase to 10 combined items; block new saves when limit reached (until user deletes)",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-6",
      "summary": "Profile persistence fix: ensure profile fields (name/photo/country) save reliably in localStorage when leaving page",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-7",
      "summary": "Moments/Vault improvements: support videos (not only images), remove music option in viewer, improve gallery card sizing/styling/motion, and ensure tap opens a clear enlarged view (square media)",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-8",
      "summary": "Splash onboarding maintenance: ensure slide media renders correctly (incl. fixing/removing non-rendering Slide 3 asset) and keep slide motion consistent across slides",
      "reqIds": [],
      "status": "blocked"
    },
    {
      "id": "AR-9",
      "summary": "Deployment/version control: resolve issue where newer drafts (e.g., 146) fail to become live and app reverts to older live version (e.g., 125)",
      "reqIds": [],
      "status": "blocked"
    }
  ],
  "architectural_notes": [
    "Frontend is a React SPA using TanStack Router; each route renders a fixed full-screen overlay with a centered mobile viewport (max 390x844).",
    "Local-first persistence: planned moments, photo moments, and user profiles are stored in localStorage; the camera→confirm→feeling flow uses sessionStorage as a multi-step draft buffer.",
    "Cross-component synchronization uses the browser 'storage' event (cross-tab) plus same-tab custom events (e.g., 'plannedMomentsChanged', 'moments_photos_updated', 'profile_updated').",
    "Planned-moment visualization is driven by per-moment stored colors and a derived date→segmentColors map (up to 3 colors per date), enabling immediate UI updates after save.",
    "Internet Identity authentication is encapsulated in a provider/hook using @dfinity/auth-client with delegation validity checks and long-lived TTL configuration.",
    "React Query is used for global caching and for an identity-keyed backend actor (useActor) that triggers invalidation/refetch of dependent queries when the actor changes.",
    "Styling combines Tailwind with extensive custom CSS (OKLCH tokens, glassmorphic surfaces, bespoke animations for onboarding/welcome, bottom sheets, and vault reveals).",
    "Camera functionality is encapsulated in a hook managing MediaStream lifecycle, facing-mode switching, and canvas-based capture to File.",
    "Backend Motoko canister composes capabilities via mixins: authorization (RBAC) and blob-storage maintenance helpers gated by environment variables.",
    "Codebase favors small dedicated hooks (usePlannedMoments, useMomentsPhotos, useProfile, useAutoGeolocation, useInView) for side effects and state adapters."
  ],
  "known_issues": [
    "backend/main.mo: storePhoto does not persist the provided blob into blob storage (comment indicates missing put call) and sets metadata timestamp to 0.",
    "backend/main.mo: getBlob is a placeholder that always returns null (blob retrieval not implemented).",
    "backend/blob-storage/Storage.mo expects env var 'CAFFFEINE_STORAGE_CASHIER_PRINCIPAL' (note the spelling) and traps if unset; deployments must match exactly.",
    "backend/authorization/access-control.mo: getUserRole traps with \"User is not registered\" until initialization occurs; callers must ensure _initializeAccessControlWithSecret runs for authenticated principals.",
    "frontend/src/pages/CalendarPage.tsx defines a PhotoMetadata interface with 'dataUrl', but momentsPhotosStorage persists 'data'; currently it only uses timestamps, but the model is inconsistent.",
    "frontend/src/utils/plannedMomentsStorage.ts subscribeToStorageChanges listens to all 'storage' events without filtering by key, causing unnecessary refresh callbacks.",
    "frontend/src/pages/CameraScreen.tsx has a flash toggle UI state, but useCamera does not implement torch/flash control (UI-only).",
    "frontend/src/components/HamburgerMenu.tsx and frontend/src/components/SignInOverlay.tsx are empty placeholders.",
    "frontend/src/pages/MomentsPage.tsx is empty/unimplemented.",
    "frontend/src/components/HomePlannedDatesRow.tsx runs a continuous requestAnimationFrame loop for auto-drift without pausing based on page visibility, which may impact battery/CPU on mobile."
  ],
  "isFixRequest": true,
  "gameProjectType": "none",
  "projectName": "Moments",
  "clarification_mode": "pro",
  "clarification_rounds": 0
}